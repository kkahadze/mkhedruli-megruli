<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mingrelian Translator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], 
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .hidden {
            display: none;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .loading {
            text-align: center;
            margin: 20px 0;
        }
        .clear-settings {
            color: #666;
            font-size: 12px;
            cursor: pointer;
            text-decoration: underline;
            display: inline-block;
            margin-top: 5px;
        }
        .clear-settings:hover {
            color: #d9534f;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Mingrelian Translator</h1>
    
    <div class="container">
        <div class="form-group">
            <label for="openaiApiKey">OpenAI API Key:</label>
            <input type="password" id="openaiApiKey" placeholder="sk-..." />
            <div style="margin-top: 5px;">
                <label style="font-weight: normal; font-size: 14px;">
                    <input type="checkbox" id="rememberOpenaiKey" style="width: auto; margin-right: 5px;" />
                    Remember OpenAI key
                </label>
            </div>
            <small>Get your key at <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></small>
        </div>
        
        <div class="form-group">
            <label for="anthropicApiKey">Anthropic API Key:</label>
            <input type="password" id="anthropicApiKey" placeholder="sk-ant-..." />
            <div style="margin-top: 5px;">
                <label style="font-weight: normal; font-size: 14px;">
                    <input type="checkbox" id="rememberAnthropicKey" style="width: auto; margin-right: 5px;" />
                    Remember Anthropic key
                </label>
                <span class="clear-settings" id="clearSettings" style="margin-left: 15px;">Clear all saved settings</span>
            </div>
            <small>Get your key at <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></small>
        </div>
        
        <div class="form-group">
            <label for="model">AI Model:</label>
            <select id="model">
                <optgroup label="OpenAI">
                    <option value="gpt-5-2025-08-07" data-provider="openai" selected>GPT-5 (Latest)</option>
                    <option value="gpt-5-pro-2025-10-06" data-provider="openai">GPT-5 Pro</option>
                </optgroup>
                <optgroup label="Anthropic">
                    <option value="claude-sonnet-4-5-20250929" data-provider="anthropic">Claude Sonnet 4.5 (Recommended)</option>
                </optgroup>
            </select>
            <small id="modelHelp">Choose the AI model for translation. All models provide excellent quality.</small>
        </div>
        
        <div class="form-group">
            <label for="targetLang">Target Language:</label>
            <select id="targetLang">
                <option value="english">English</option>
                <option value="georgian">Georgian</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="mingrelianText">Mingrelian Text:</label>
            <textarea id="mingrelianText" placeholder="Enter Mingrelian text here (latinized or mkhedruli)"></textarea>
        </div>
        
        <button id="translateBtn">Translate</button>
        
        <div id="loading" class="loading hidden">
            <p>Translating... This may take a few seconds...</p>
        </div>
        
        <div id="error" class="error hidden"></div>
        
        <div id="resultContainer" class="result hidden">
            <h2>Translation Results</h2>
            <table>
                <tr>
                    <th>Language</th>
                    <th>Text</th>
                </tr>
                <tr>
                    <td>Mingrelian</td>
                    <td id="mingrelianCombined"></td>
                </tr>
                <tr>
                    <td>Georgian</td>
                    <td id="georgian"></td>
                </tr>
                <tr>
                    <td>English</td>
                    <td id="english"></td>
                </tr>
            </table>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="fullResponse">Full Response:</label>
                <textarea id="fullResponse" readonly></textarea>
            </div>
        </div>
    </div>
    
    <script>
        // Convert Georgian Mkhedruli script to latinized Georgian
        function mkhedruliToLatinized(text) {
            const georgianToLatin = {
                'ა': 'a', 'ბ': 'b', 'გ': 'g', 'დ': 'd', 'ე': 'e',
                'ვ': 'v', 'ზ': 'z', 'თ': 't', 'ი': 'i', 'კ': "k'",
                'ლ': 'l', 'მ': 'm', 'ნ': 'n', 'ო': 'o', 'პ': "p'",
                'ჟ': 'zh', 'რ': 'r', 'ს': 's', 'ტ': "t'", 'უ': 'u',
                'ფ': 'p', 'ქ': 'k', 'ღ': 'gh', 'ყ': 'q', 'შ': 'sh',
                'ჩ': 'ch', 'ც': 'c', 'ძ': 'dz', 'წ': "ts'", 'ჭ': "ch'",
                'ხ': 'x', 'ჯ': 'j', 'ჰ': 'h', 'ჷ': "e'", 'ჸ': '՚',
                'ʼ': "'"
            };
            
            let result = '';
            for (let char of text) {
                result += georgianToLatin[char] || char;
            }
            return result;
        }
        
        // Load saved preferences from localStorage on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedOpenaiKey = localStorage.getItem('mingrelian_openai_key');
            const savedAnthropicKey = localStorage.getItem('mingrelian_anthropic_key');
            const savedModel = localStorage.getItem('mingrelian_model');
            const savedTargetLang = localStorage.getItem('mingrelian_target_lang');
            const rememberOpenaiKey = localStorage.getItem('mingrelian_remember_openai_key') === 'true';
            const rememberAnthropicKey = localStorage.getItem('mingrelian_remember_anthropic_key') === 'true';
            
            // Restore OpenAI API key if saved
            if (savedOpenaiKey && rememberOpenaiKey) {
                document.getElementById('openaiApiKey').value = savedOpenaiKey;
                document.getElementById('rememberOpenaiKey').checked = true;
            }
            
            // Restore Anthropic API key if saved
            if (savedAnthropicKey && rememberAnthropicKey) {
                document.getElementById('anthropicApiKey').value = savedAnthropicKey;
                document.getElementById('rememberAnthropicKey').checked = true;
            }
            
            // Restore model preference if saved
            if (savedModel) {
                document.getElementById('model').value = savedModel;
            }
            
            // Restore target language preference if saved
            if (savedTargetLang) {
                document.getElementById('targetLang').value = savedTargetLang;
            }
        });
        
        // Save preferences when "Remember OpenAI Key" checkbox changes
        document.getElementById('rememberOpenaiKey').addEventListener('change', function() {
            const isChecked = this.checked;
            localStorage.setItem('mingrelian_remember_openai_key', isChecked);
            
            if (isChecked) {
                // Save current OpenAI API key
                const apiKey = document.getElementById('openaiApiKey').value.trim();
                if (apiKey) {
                    localStorage.setItem('mingrelian_openai_key', apiKey);
                }
            } else {
                // Clear saved OpenAI API key
                localStorage.removeItem('mingrelian_openai_key');
            }
        });
        
        // Save OpenAI API key when it changes (if remember is checked)
        document.getElementById('openaiApiKey').addEventListener('input', function() {
            if (document.getElementById('rememberOpenaiKey').checked) {
                localStorage.setItem('mingrelian_openai_key', this.value.trim());
            }
        });
        
        // Save preferences when "Remember Anthropic Key" checkbox changes
        document.getElementById('rememberAnthropicKey').addEventListener('change', function() {
            const isChecked = this.checked;
            localStorage.setItem('mingrelian_remember_anthropic_key', isChecked);
            
            if (isChecked) {
                // Save current Anthropic API key
                const apiKey = document.getElementById('anthropicApiKey').value.trim();
                if (apiKey) {
                    localStorage.setItem('mingrelian_anthropic_key', apiKey);
                }
            } else {
                // Clear saved Anthropic API key
                localStorage.removeItem('mingrelian_anthropic_key');
            }
        });
        
        // Save Anthropic API key when it changes (if remember is checked)
        document.getElementById('anthropicApiKey').addEventListener('input', function() {
            if (document.getElementById('rememberAnthropicKey').checked) {
                localStorage.setItem('mingrelian_anthropic_key', this.value.trim());
            }
        });
        
        // Save model preference when it changes
        document.getElementById('model').addEventListener('change', function() {
            localStorage.setItem('mingrelian_model', this.value);
        });
        
        // Save target language preference when it changes
        document.getElementById('targetLang').addEventListener('change', function() {
            localStorage.setItem('mingrelian_target_lang', this.value);
        });
        
        // Clear all saved settings
        document.getElementById('clearSettings').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all saved settings (API keys, model, language)?')) {
                localStorage.removeItem('mingrelian_openai_key');
                localStorage.removeItem('mingrelian_anthropic_key');
                localStorage.removeItem('mingrelian_model');
                localStorage.removeItem('mingrelian_target_lang');
                localStorage.removeItem('mingrelian_remember_openai_key');
                localStorage.removeItem('mingrelian_remember_anthropic_key');
                
                // Clear form
                document.getElementById('openaiApiKey').value = '';
                document.getElementById('anthropicApiKey').value = '';
                document.getElementById('rememberOpenaiKey').checked = false;
                document.getElementById('rememberAnthropicKey').checked = false;
                document.getElementById('model').value = 'gpt-5-2025-08-07';
                document.getElementById('targetLang').value = 'english';
                
                alert('All saved settings have been cleared!');
            }
        });
        
        document.getElementById('translateBtn').addEventListener('click', async function() {
            // Get values from form
            const modelSelect = document.getElementById('model');
            const model = modelSelect.value;
            const selectedOption = modelSelect.options[modelSelect.selectedIndex];
            const provider = selectedOption.getAttribute('data-provider');
            const targetLang = document.getElementById('targetLang').value;
            const mingrelianText = document.getElementById('mingrelianText').value.trim();
            
            // Get the appropriate API key based on provider
            let apiKey;
            if (provider === 'anthropic') {
                apiKey = document.getElementById('anthropicApiKey').value.trim();
            } else {
                apiKey = document.getElementById('openaiApiKey').value.trim();
            }
            
            // Validate inputs
            if (!apiKey) {
                const providerName = provider === 'anthropic' ? 'Anthropic' : 'OpenAI';
                showError(`Please enter your ${providerName} API key`);
                return;
            }
            
            if (!mingrelianText) {
                showError('Please enter Mingrelian text to translate');
                return;
            }
            
            // Hide any previous results or errors
            document.getElementById('error').classList.add('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            
            // Show loading indicator with model name
            const modelName = selectedOption.text;
            document.getElementById('loading').innerHTML = `<p>Translating with ${modelName}... This may take a few seconds...</p>`;
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                // Make API request
                const response = await fetch('https://argo-translator.onrender.com/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: mingrelianText,
                        api_key: apiKey,
                        target_language: targetLang,
                        model: model,
                        provider: provider
                    })
                });
                
                // Hide loading indicator
                document.getElementById('loading').classList.add('hidden');
                
                if (!response.ok) {
                    const errorData = await response.json();
                    showError(`API error: ${errorData.detail || response.statusText}`);
                    return;
                }
                
                // Process successful response
                const data = await response.json();
                
                // Update the result fields
                // Combine Mingrelian mkhedruli and latinized: "გომორძგუა /gomordzgua/"
                const mingrelianCombined = `${data.mingrelian_mkhedruli} /${data.mingrelian_latinized}/`;
                document.getElementById('mingrelianCombined').textContent = mingrelianCombined;
                
                // Combine Georgian mkhedruli and latinized: "შვილი /shvili/"
                const georgianLatinized = mkhedruliToLatinized(data.georgian);
                const georgianCombined = `${data.georgian} /${georgianLatinized}/`;
                document.getElementById('georgian').textContent = georgianCombined;
                
                document.getElementById('english').textContent = data.english;
                document.getElementById('fullResponse').value = data.full_response;
                
                // Show the result container
                document.getElementById('resultContainer').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                showError(`Network error: ${error.message}`);
                document.getElementById('loading').classList.add('hidden');
            }
        });
        
        function showError(message) {
            const errorElement = document.getElementById('error');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }
    </script>
</body>
</html> 